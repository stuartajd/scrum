<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Scrum</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<link rel="icon" type="image/svg+xml" href="scrum.svg">

		<style>
			html { height:100%; }
			body { min-height: 100%; display: flex; flex-direction:  column; }
			main { flex-grow: 1; background-color: #eee;}
			html, body {
				font-family: 'Inter', sans-serif;
			}

			.container {
				max-width: 960px;
			}

			.fw-black {
				font-weight: 900;
			}

			.output > * {
				font-family: Calibri, sans-serif!important;
				font-size: 10pt !important;
				background-color: transparent!important;
			}

			main, main > * {
				transition: all ease-in-out 250ms;
			}

			.darkMode {
				background-color:  #121212;
				color: #eee;
			}

			.btn-link {
				color: black;
			}

			.darkMode input, .darkMode .modal-content, .darkMode input:focus, .darkMode textarea, .darkMode textarea:focus, .darkMode select, .darkMode .card {
				background-color:  #444;
				color: #eee;
			}

			.darkMode h2, .darkMode .text-muted, .darkMode .btn-link, .darkMode label, .darkMode .handle, .darkMode svg:not(.ignore-dark-mode) {
				color:  #eee!important;
			}

			.darkMode .darker {
				color:  #9d9d9d!important;
			}

			[v-cloak] {
				display:  none!important;
			}

			.cursor-pointer {
				cursor: pointer;
			}

			.fs-small {
				font-size:  14px;
			}

			.text-shadow {
  				text-shadow: 0 0 7px #000;
			}

			code {
				background-color: #f520733d;
				border: 1px solid #f52073;
			}

			.whitespace-pre-line {
				white-space: pre-line;
			}

			.spinner {
				animation: 1.5s ease-in-out infinite spinner;
			}

			@keyframes spinner { 
				from { transform: rotate(-10deg) scale(1); }
				50% { transform: rotate(15deg) scale(1.1); }
				to { transform: rotate(-10deg) scale(1); }
			}

			.colour-red { color: #fd6262; }
			.colour-orange { color: #df9000; }
		</style>
	</head>
	<body>
		<noscript>
			You are using an unsupported browser, please enable Javascript to use this application.
		</noscript>

		<main v-cloak id="app" class="h-100" :class="{ darkMode: !settings.lightMode }" >
			<div class="border mb-3 output visually-hidden" ref="taskNotes" style="font-family: Calibri, sans-serif;font-size: 10pt;"><span>
				<strong>{{settings.name}}</strong><br />
				<strong>{{todaysDate}}</strong><br /><br />
				
				<template v-for="task in tasksWithDetails">
					<br /><br />
					<strong>Task: {{task.name}}</strong><br />
					
					<span v-if="(task.techStatus && task.techStatus.length) || task.status.length" class="whitespace-pre-line">
						Status:
						<span v-if="task.techStatus && task.techStatus.length"> [{{task.techStatus}}]</span> 
						<span v-if="task.status.length">{{task.status}}</span><br />
						<span v-if="task.dueDate && task.dueDate.length">Due Date: {{task.dueDate}}<br /></span>
					</span>

					<span v-if="task.hours" class="text-capitalize">
						Expected Hours Today: {{task.hours}}<br />
					</span>
					
					<span v-if="task.priority" class="text-capitalize">
						Priority: {{task.priority}}<br />
					</span>

					<i>Blocked: {{(task.blocked) ? 'Yes' : 'No'}}</i>
				</template>
				
				<template v-if="blockedTasks.length">
					<br />
					<strong>Blocked on {{blockedTasks.length}} task<span v-if="blockedTasks.length > 1">s</span></strong>
				</template>
				
				<u><strong>Capacity: <span style="text-transform:capitalize">{{settings.capacity}}</span></strong></u>
			</span></div>
				
			<div class="container position-relative">
				<div class="position-absolute end-0 py-3 me-2">
					<div v-if="settings.lightMode">
						<svg @click="useLightMode(false)" class="text-dark cursor-pointer spinner" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill="currentColor"><rect fill="none" height="24" width="24"/><path d="M11.01,3.05C6.51,3.54,3,7.36,3,12c0,4.97,4.03,9,9,9c4.63,0,8.45-3.5,8.95-8c0.09-0.79-0.78-1.42-1.54-0.95 c-0.84,0.54-1.84,0.85-2.91,0.85c-2.98,0-5.4-2.42-5.4-5.4c0-1.06,0.31-2.06,0.84-2.89C12.39,3.94,11.9,2.98,11.01,3.05z"/></svg>
					</div>
					
					<div v-if="!settings.lightMode">
						<svg @click="useLightMode(true)" class="cursor-pointer ignore-dark-mode text-warning spinner" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill="currentColor"><rect fill="none" height="24" width="24"/><path d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41 l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg>
					</div>
				</div>

				<div class="py-5">
					<div class="mb-5">
						<div class="mb-3 d-flex align-items-center justify-content-start">
							<svg class="ignore-dark-mode me-3" xmlns="http://www.w3.org/2000/svg" height="72" viewBox="0 0 24 24" width="72" fill="#1f97d5"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 14H6v-2h2v2zm0-3H6V9h2v2zm0-3H6V6h2v2zm6 6h-3c-.55 0-1-.45-1-1s.45-1 1-1h3c.55 0 1 .45 1 1s-.45 1-1 1zm3-3h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm0-3h-6c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1z"/></svg>
						
							<h1 class="fw-black">Scrum</h1>
						</div>
					</div>

					<div v-if="tasksWithDetails.length" class="mb-5">
						<div class="alert alert-secondary alert-sm d-flex align-items-center justify-content-between" role="alert">
					  		<div>
				  				You've got {{tasksWithDetails.length}} tasks recorded, you can now copy the notes to use in Microsoft Teams.
					  		</div>
						  	<div>
						    	<button @click="copy" class="btn btn-secondary">Copy Notes</button>
						  	</div>
						</div>
					</div>

					<div class="mb-5">
						<h2 class="text-muted fw-bold mb-3">Your Status</h2>

						<div class="row">
							<div class="col-md-6">
								<label for="personName" class="form-label">Your Name</label>
								<input @change="sync" type="text" v-model="settings.name" class="form-control" id="personName" placeholder="Joe Bloggs">
							</div>
							<div class="col-md-6">
							  	<label for="capcity" class="form-label">Your Capacity</label>
							  	<select @change="sync" v-model="settings.capacity" class="form-select">
								  	<option value="" selected disabled>Select Capacity</option>
								  	<option value="light" selected="">Light (&lt; 50% Capacity - &gt; 3 hours available)</option>
							        <option value="medium">Medium (50-85% Capacity - 1-3 hours available)</option>
							        <option value="busy">Busy (85-95% Capacity - &lt; 1 hours)</option>
							        <option value="full">Full (100% Capacity - No free capacity)</option>
							        <option value="overloaded">Overloaded (100% Capacity - Cannot meet current deadlines)</option>
								</select>
							</div>
						</div>						
					</div>

					<div ref="taskEditor">
						<div v-if="selectedTask" class="border p-3 mb-4">
							<div>
								<h2 class="text-muted fw-bold"><template v-if="isCreating">New</template><template v-else>Edit</template> Task</h2>
							</div>

							<p class="text-muted small">Tasks need to have atleast a name specified to be included in the scrum notes.</p>

							<div>
								<div class="mb-3">
								  	<label for="taskName" class="form-label">Task Name</label>
								  	<input type="text" v-model="selectedTask.name" class="form-control" id="taskName" placeholder="Example Project or https://eu1.clarizen.com/Clarizen/Task/.....">
								</div>
								
								<div class="mb-3">
								  	<label for="taskStatus" class="form-label">Task Status</label>
								  	<textarea class="form-control" v-model="selectedTask.status" id="taskStatus" rows="3"></textarea>
								</div>

								<div class="row gx-3 align-items-start my-3 justify-content-between">
									<div class="col-6">
									  	<label for="techStatus" class="form-label">Tech Status</label>
									  	<select id="techStatus" v-model="selectedTask.techStatus" class="form-select">
										  	<option value="" selected disabled>Select Tech Status</option>
											<option value="Awaiting Content">Awaiting Content</option>
											<option value="Awaiting Brief">Awaiting Brief</option>
											<option value="Ready to start">Ready to start</option>
											<option value="Pre-Build Checks">Pre-Build Checks</option>
											<option value="Blocked">Blocked</option>
											<option value="On Hold">On Hold</option>
											<option value="Queued">Queued</option>
											<option value="At Risk">At Risk</option>
											<option value="In Progress">In Progress</option>
											<option value="Ready for QA">Ready for QA</option>
											<option value="Post QA - development">Post QA - development</option>
											<option value="With Client">With Client</option>
											<option value="With Client Team">With Client Team</option>
											<option value="Signed Off">Signed Off</option>
											<option value="Complete">Complete</option>
										</select>
									</div>

									<div class="col-6">
										<div class="mb-3">
										  	<label for="dueDate" class="form-label">Task Due Date</label>
										  	<input type="date" class="form-control" v-model="selectedTask.dueDate" id="dueDate" />
										</div>
									</div>
								</div>
								
								<div class="row gx-3 align-items-start my-3 justify-content-between">
									<div class="col-6 mb-3">
										<div>
											<label for="priority" class="form-label">Task Priority</label>
										</div>

										<div class="form-check form-check-inline">
											<input v-model="selectedTask.priority" class="form-check-input" type="radio" name="priority" id="none" value="">
											<label class="form-check-label" for="none">Not a Priority</label>
										</div>
										<div class="form-check form-check-inline">
											<input v-model="selectedTask.priority" class="form-check-input" type="radio" name="priority" id="low" value="low">
											<label class="form-check-label" for="low">Low</label>
										</div>
										<div class="form-check form-check-inline">
											<input v-model="selectedTask.priority" class="form-check-input" type="radio" name="priority" id="medium" value="medium">
											<label class="form-check-label" for="medium">Medium</label>
										</div>
										<div class="form-check form-check-inline">
											<input v-model="selectedTask.priority" class="form-check-input" type="radio" name="priority" id="high" value="high">
											<label class="form-check-label" for="high">High</label>
										</div>
									</div>

									<div class="col-6">
										<div class="mb-3">
										  	<label for="hours" class="form-label">Expected Hours Today</label>
										  	<input type="number" class="form-control" v-model="selectedTask.hours" id="hours" />
										</div>
									</div>
								</div>
								
								<div class="mb-3">
								  	<div class="form-check form-switch">
									  	<input class="form-check-input" v-model="selectedTask.blocked" type="checkbox" role="switch" id="taskBlocked">
									  	<label class="form-check-label" for="taskBlocked">Is this task blocked?</label>
									</div>
								</div>
							</div>

							<div>
								<button v-if="!isCreating" @click="remove(selectedTask)" class="btn btn-danger btn-sm">Delete Task</button>
								<button v-if="!isCreating" @click="close" class="btn btn-success btn-sm">Save Task</button>

								<button v-if="isCreating" @click="remove(selectedTask, true)" class="btn btn-secondary btn-sm">Cancel</button>
								<button v-if="isCreating" @click="close" class="btn btn-success btn-sm">Create Task</button>
							</div>
						</div>	
					</div>
										

					<div>
						<div class="mb-3 d-flex align-items-center justify-content-between">
							<h2 class="text-muted fw-bold mb-0">Your Tasks</h2>

							<div>
								<button @click="sort('priority')" class="btn btn-sm btn-secondary me-2">
									<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>

									Sort by Priority
								</button>

								<button @click="create" class="btn btn-sm btn-success">
									<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><g><rect fill="none" height="24" width="24"/></g><g><g/><g><path d="M17,19.22H5V7h7V5H5C3.9,5,3,5.9,3,7v12c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2v-7h-2V19.22z"/><path d="M19,2h-2v3h-3c0.01,0.01,0,2,0,2h3v2.99c0.01,0.01,2,0,2,0V7h3V5h-3V2z"/><rect height="2" width="8" x="7" y="9"/><polygon points="7,12 7,14 15,14 15,12 12,12"/><rect height="2" width="8" x="7" y="15"/></g></g></svg>

									Add New Task
								</button>
							</div>
						</div>
						<div>
							<div v-if="!tasks.length" class="border p-3">
								You have no tasks, create a new one to get started.
							</div>
							<draggable v-if="tasks.length" v-model="tasks" handle=".handle" class="mb-3">
								<div v-for="(task, index) in tasks" :key="task.uid" class="card" :class="{ 'mb-3': settings.view === 'full' }">
									<div class="d-flex justify-content-start align-items-stretch">
										<div class="p-3 d-flex align-items-center handle cursor-pointer">
											<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 9H5c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1zM5 15h14c.55 0 1-.45 1-1s-.45-1-1-1H5c-.55 0-1 .45-1 1s.45 1 1 1z"/></svg>
										</div>

										<div class="card-body d-flex align-items-center justify-content-between lh-sm">
											<div>
												<h6 class="mt-0 mb-0 fw-bold">{{task.name || "Set a Task Name"}}</h6>

												<div v-if="task.status" class="fs-small mt-2 whitespace-pre-line">{{task.status}}</div>

												<div v-if="settings.view === 'full'" class="darker mt-2 fs-small d-flex align-items-center justify-content-start">
													<span v-if="task.priority" content="Task Priority" v-tippy="{ arrow: true }">
														<span v-if="task.priority === 'high'" class="me-4 colour-red">
															<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><g><rect fill="none" height="24" width="24"/></g><g><g><polygon points="6,17.59 7.41,19 12,14.42 16.59,19 18,17.59 12,11.59"/><polygon points="6,11 7.41,12.41 12,7.83 16.59,12.41 18,11 12,5"/></g></g></svg>

															High Priority
														</span>

														<span v-if="task.priority === 'medium'" class="me-4 colour-orange">
															<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"/></svg>

															Medium Priority
														</span>

														<span v-if="task.priority === 'low'" class="me-4">
															<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><g><rect fill="none" fill-rule="evenodd" height="24" width="24"/><g><rect fill-rule="evenodd" height="2" width="16" x="4" y="11"/></g></g></svg>

															Low Priority
														</span>
													</span>

													<span class="me-4" content="Tech Status" v-tippy="{ arrow: true }">
														<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><g><rect fill="none" height="24" width="24" x="0"/></g><g><g><polygon points="7.41,13.41 6,12 2,16 6,20 7.41,18.59 5.83,17 21,17 21,15 5.83,15"/><polygon points="16.59,10.59 18,12 22,8 18,4 16.59,5.41 18.17,7 3,7 3,9 18.17,9"/></g></g></svg>
														{{task.techStatus || "No Tech Status"}}
													</span>

													<span class="me-4" v-if="!task.blocked" content="Blocked Status" v-tippy="{ arrow: true }">
														<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"/></svg>
														Not Blocked
													</span>

													<span class="me-4 colour-red" v-if="task.blocked" content="Blocked Status" v-tippy="{ arrow: true }">
														<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
														Blocked
													</span>

													<span v-if="task.dueDate" content="Due Date" v-tippy="{ arrow: true }">
														<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><path d="M0 0h24v24H0z" fill="none"/><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
														{{new Date(task.dueDate).toLocaleDateString()}}
													</span>

													<span v-if="task.hours" content="Hours Expected Today" v-tippy="{ arrow: true }">
														<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor" class="ignore-dark-mode"><path d="M0 0h24v24H0z" fill="none"/><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
														{{task.hours}} hours
													</span>
												</div>
											</div>
										</div>
										<div class="flex-shrink-0 align-self-center me-3">
											<div class="d-flex align-items-center flex-grow-1">
												<div @click="edit(task)" class="me-2">
													<svg class="cursor-pointer" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
												</div>
												<div @click="remove(task)" class="">
													<svg class="cursor-pointer" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>
												</div>	
											</div>
										</div>
									</div>
								</div>
							</draggable>
						</div>
					</div>

					<div v-if="archivedTasks.length || settings.showArchivedTasks" class="mt-3">
						<button @click="settings.showArchivedTasks = !settings.showArchivedTasks" class="btn btn-sm btn-secondary">
							<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg>
							<span v-if="!settings.showArchivedTasks">View</span><span v-else>Hide</span> Archived Tasks
						</button>
					</div>			

					<div v-if="settings.showArchivedTasks">
						<div class="mt-5 mb-3">
							<h2 class="text-muted fw-bold mb-0">Your Archived Tasks</h2>
							<p class="fs-small">You are able to restore tasks that were deleted within the past 7 days. Tasks are automatically removed when you visit on the 7th day.</p>
						</div>
						<div>
							<div v-if="!archivedTasks.length" class="border p-3">
								You have no archived tasks.
							</div>
							<div v-if="archivedTasks.length" class="mb-3">
								<div v-for="(task, index) in archivedTasks" :key="task.uid" class="card" :class="{ 'mb-3': settings.view === 'full' }">
									<div class="d-flex justify-content-start align-items-stretch">
										<div class="p-3 d-flex align-items-center handle cursor-pointer">
											<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 9H5c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1zM5 15h14c.55 0 1-.45 1-1s-.45-1-1-1H5c-.55 0-1 .45-1 1s.45 1 1 1z"/></svg>
										</div>

										<div class="card-body d-flex align-items-center justify-content-between lh-sm">
											<div>
												<h6 class="mt-0 mb-0 fw-bold">{{task.name || "Set a Task Name"}}</h6>
												<div v-if="task.status" class="fs-small mt-2 whitespace-pre-line">{{task.status}}</div>
											</div>
										</div>
										<div class="flex-shrink-0 align-self-center me-3">
											<div class="d-flex align-items-center flex-grow-1">
												<div @click="restore(task)" class="cursor-pointer me-2" content="Restore" v-tippy="{ arrow: true }">
													<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
												</div>	

												<div @click="remove(task, true)" class="">
													<svg class="cursor-pointer" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>
												</div>	
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="text-center my-5 fs-small">
						<p class="mb-2">Created with <span class="text-danger">â™¥</span> by Stuart</p>

						<button @click="setView('minified')" v-if="settings.view === 'full'" class="btn btn-link fs-small">View mode: Full</button>						
						<button @click="setView('full')" v-if="settings.view === 'minified'" class="btn btn-link fs-small">View mode: Minified</button>					

						<button @click="clearAllTasks" class="btn btn-link fs-small">Clear All Tasks</button>						
						<button @click="clearAll" class="btn btn-link fs-small">Reset Everything</button>
					</div>
				</div>
			</div>
		</main>

		<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue-tippy/dist/vue-tippy.min.js"></script>

		<script>
			var app = new Vue({
				el: '#app',
				components: {
				    draggable: window['vuedraggable'],
				    tippy: window['tippy']
				},
				data: {
					isCreating: false,
					selectedTask: null,
					tasks: [],
					archivedTasks: [],
					settings: {
						name: '',
						capacity: '',
						lightMode: true,
						view: 'full',
						showArchivedTasks: false,
					}
				},
				mounted: function(){
					var tasks = this.fetchFromStorage("scrumTasks", JSON.stringify([]));
					this.tasks = JSON.parse(tasks);

					var archivedTasks = this.fetchFromStorage("scrumArchivedTasks", JSON.stringify([]));
					this.archivedTasks = JSON.parse(archivedTasks);

					this.settings.lightMode = !(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);

					var settings = this.fetchFromStorage("scrumSettings", {});
					this.settings = Object.assign(this.settings, JSON.parse(settings));

					// Delete all from archived where the date is today.
					var deleteBefore = new Date();
					deleteBefore.setDate(deleteBefore.getDate() - 7);
					this.archivedTasks = this.archivedTasks.filter(function(task){
						return new Date(task.deletedDate) >= deleteBefore;
					});
				},
				watch: {
					tasks: function(){
						this.sync();
					},
					archivedTasks: function(){
						this.sync();
					}
				},
				computed: {
					tasksWithDetails: function(){
						return this.tasks.filter(function(task) { return task.name.trim().length });
					},
					blockedTasks: function(){
						return this.tasks.filter(function(task) { return task.blocked });
					},
					todaysDate: function(){
						var date = new Date();
						return ('0' + date.getDate()).slice(-2) + '/'
             					+ ('0' + (date.getMonth()+1)).slice(-2) + '/'
             					+ date.getFullYear();
					}
				},
				methods: {
					setView: function(viewMode) {
						this.settings.view = viewMode;
						this.sync();
					},
					fetchFromStorage: function(key, defaultValue){
						var item = localStorage.getItem(key);
						return item || defaultValue;
					},
					useLightMode: function(status){
						this.settings.lightMode = status;
						this.sync();
					},
					sort: function(sortField){
						this.tasks = this.tasks.sort(function(a, b){
							var sortFlags = {
								priority: ['high', 'medium', 'low', '']
							}

							if(!a[sortField]) return 1;
							if(!b[sortField]) return -1;

							return sortFlags[sortField].indexOf(a[sortField]) - sortFlags[sortField].indexOf(b[sortField]);
						});

						this.sync();
					},
					sync: function() {
						localStorage.setItem('scrumTasks', JSON.stringify(this.tasks));
						localStorage.setItem('scrumArchivedTasks', JSON.stringify(this.archivedTasks));
						localStorage.setItem('scrumSettings', JSON.stringify(this.settings));
					},
					copy: function() {
						var range = document.createRange();
				        range.selectNode(this.$refs.taskNotes);
				        window.getSelection().removeAllRanges();
				        window.getSelection().addRange(range);
				        document.execCommand("copy");
				        window.getSelection().removeAllRanges();
					},
					create: function() {
						this.isCreating = true;
						var task = {
							uid: Date.now().toString(36) + Math.random().toString(36).substr(2),
							name: '',
							status: '',
							techStatus: '',
							priority: '',
							dueDate: '',
							hours: 0,
							createdDate: Date.now(),
							blocked: false
						};
					
						this.tasks.push(task);
						this.selectedTask = task;
						this.$refs.taskEditor.scrollIntoView(true);						
					},
					edit: function(task){
						this.isCreating = false;
						this.selectedTask = task;
						console.log(this.$refs);
						this.$refs.taskEditor.scrollIntoView(true);
					},
					remove: function(task, force){
						if(this.selectedTask !== null && task.uid === this.selectedTask.uid){
							this.selectedTask = null;
						}

						if(!force){ 
							task.deletedDate = Date.now();
							this.archivedTasks.push(task);
						}

						if(force){
							this.archivedTasks = this.archivedTasks.filter(function(t) { return t.uid !== task.uid });
						}
						
						this.tasks = this.tasks.filter(function(t) { return t.uid !== task.uid });
					},
					restore: function(task){
						this.tasks.push(task);
						this.archivedTasks = this.archivedTasks.filter(function(t) { return t.uid !== task.uid });
					},
					clearAllTasks: function(){
						this.tasks = [];
						this.archivedTasks = [];
						this.sync();
					},
					clearAll: function(){
						this.settings.name = "";
						this.settings.capacity = "";
						this.clearAllTasks();
					},
					close: function(){
						this.selectedTask = null;
						this.isCreating = false;
						this.sync();
					}
				}
			})
		</script>
	</body>
</html>
